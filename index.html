<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="color-scheme" content="light only">
<title>Pod Display</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
<style>
html,body{margin:0;padding:0;height:100%;width:100%;
  background:#fff;color:#111;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  overflow:hidden;}
.app{position:relative;height:100vh;width:100vw;overflow:hidden;background:#fff;}
/* header */
.brand{position:fixed;left:20px;top:15px;display:flex;align-items:center;gap:10px;
  background:rgba(255,255,255,.9);padding:4px 10px;border-radius:8px;z-index:5;box-shadow:0 0 10px rgba(0,0,0,.05);}
.brand img{height:36px;width:auto;}
.brand .title{font-weight:700;font-size:22px;color:#111;}
/* slide */
.slide{position:absolute;inset:0;display:none;background:#fff;}
.slide.active{display:block;animation:fade .3s ease;}
@keyframes fade{from{opacity:.05}to{opacity:1}}
/* images */
.imageWrap{display:flex;align-items:center;justify-content:center;height:100%;}
.imageCard{width:100%;height:100%;display:flex;align-items:center;justify-content:center;}
.imageCard img{max-width:100%;max-height:100%;object-fit:contain;border-radius:20px;box-shadow:0 8px 30px rgba(0,0,0,.1);}
.imageTitle{text-align:center;font-weight:700;font-size:46px;position:absolute;top:65px;left:0;right:0;color:#fff;
  text-shadow:0 2px 6px rgba(0,0,0,.6);}
.imageTitle::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;}
/* next booking */
.nextWrap{display:flex;align-items:center;justify-content:center;height:100%;background:#fff;}
.nextCard{padding:38px 46px;background:#fff;border-radius:24px;box-shadow:0 8px 24px rgba(0,0,0,.1);text-align:center;}
.nb-title{font-size:32px;font-weight:700;margin-bottom:16px;}
.nb-name{font-size:24px;font-weight:700;}
.nb-line{font-size:19px;color:#555;margin:3px 0;}
.nb-when{font-size:22px;margin-top:10px;color:#000;}
.chip{display:inline-block;margin-top:16px;background:#1ea24b;color:#fff;border-radius:999px;padding:8px 14px;font-weight:600;}
/* calendar */
.calWrap{display:flex;align-items:center;justify-content:center;height:100%;background:#fff;}
.calCard{width:90%;max-width:1280px;height:90%;background:#fff;border-radius:24px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);padding:20px 30px;display:flex;flex-direction:column;}
.calHeader{text-align:center;margin-bottom:10px;}
.calHeader h2{margin:0;font-size:32px;font-weight:700;}
.calHeader .month{color:#666;font-size:18px;}
.calendar{flex:1;display:grid;grid-template-columns:repeat(7,1fr);
  grid-auto-rows:minmax(80px,1fr);gap:8px;width:100%;height:100%;}
.day{background:#f8f9fa;border-radius:12px;padding:6px 6px 2px 6px;position:relative;overflow:hidden;}
.day.today{outline:2px solid #137cbd;}
.dayNum{font-size:14px;color:#555;font-weight:600;}
.event{background:#c7efd2;color:#13692f;border-radius:6px;font-size:12px;padding:3px 5px;margin-top:4px;white-space:nowrap;
  overflow:hidden;text-overflow:ellipsis;}
.wm{position:fixed;bottom:8px;left:50%;transform:translateX(-50%);font-size:12px;color:#888;}
</style>
</head>
<body>
<div class="app">
  <div class="brand"><img src="assets/TraccLogo1.png"><div class="title" id="brandTitle">Loading…</div></div>

  <section class="slide" id="s1">
    <div class="imageWrap"><div class="imageCard"><img id="img1"></div></div>
    <div class="imageTitle" id="title1"></div>
  </section>

  <section class="slide" id="s2">
    <div class="nextWrap">
      <div class="nextCard">
        <div class="nb-title">Next Booking</div>
        <div class="nb-name" id="nbName">—</div>
        <div class="nb-line" id="nbOrg"></div>
        <div class="nb-when" id="nbWhen"></div>
        <div class="nb-line" id="nbLoc"></div>
        <div class="chip" id="nbChip" style="display:none;">Busy</div>
      </div>
    </div>
  </section>

  <section class="slide" id="s3">
    <div class="imageWrap"><div class="imageCard"><img id="img2"></div></div>
    <div class="imageTitle" id="title2"></div>
  </section>

  <section class="slide" id="s4">
    <div class="calWrap">
      <div class="calCard">
        <div class="calHeader">
          <h2>Monthly View</h2>
          <div class="month" id="monthName"></div>
        </div>
        <div class="calendar" id="calendar"></div>
      </div>
    </div>
  </section>

  <section class="slide" id="s5">
    <div class="imageWrap"><div class="imageCard"><img id="img3"></div></div>
    <div class="imageTitle" id="title3"></div>
  </section>

  <div class="wm">©️ Tracc Civil | Pod Display System</div>
</div>

<script>
const { DateTime } = luxon;
const PERTH = 'Australia/Perth';
const DUR = [10000,15000,15000,15000,10000];
const slides=['s1','s2','s3','s4','s5'];let i=0;
function showSlide(k){document.querySelectorAll('.slide').forEach(s=>s.classList.remove('active'));
document.getElementById(slides[k]).classList.add('active');}
async function getSettings(){const r=await fetch('config/settings.json?'+Date.now());return r.json();}
function parseUTCtoAWST(str){const d=DateTime.fromFormat(str,'d/L/yyyy HH:mm',{zone:'utc'});return d.setZone(PERTH);}
(async()=>{
const qs=new URLSearchParams(location.search);const pod=qs.get('pod')||'FernsPool';
const cfg=await getSettings();const p=cfg.pods[pod]||Object.values(cfg.pods)[0];
document.getElementById('brandTitle').textContent=p.displayName;
['title1','title2','title3'].forEach(id=>document.getElementById(id).textContent=p.displayName);
document.getElementById('img1').src=p.imagesPath+'01.jpg';
document.getElementById('img2').src=p.imagesPath+'02.jpg';
document.getElementById('img3').src=p.imagesPath+'03.jpg';
const data=await fetch(p.endpoint,{method:'POST',headers:{'Content-Type':'application/json'},body:'{}'}).then(r=>r.json());
const evts=(Array.isArray(data)?data:[]).map(e=>({
sub:e.subject,org:e.organizer,start:e.start,end:e.end,loc:e.location||p.displayName}));
if(evts.length){const next=evts.sort((a,b)=>DateTime.fromFormat(a.start,'d/L/yyyy HH:mm')-
DateTime.fromFormat(b.start,'d/L/yyyy HH:mm'))[0];
const s=parseUTCtoAWST(next.start),e=parseUTCtoAWST(next.end);
document.getElementById('nbName').textContent=next.sub||'—';
document.getElementById('nbOrg').textContent='Organizer: '+(next.org||'—');
document.getElementById('nbWhen').textContent=⁠ ${s.toFormat('ccc dd LLL yyyy')} — ${s.toFormat('HH:mm')} to ${e.toFormat('HH:mm')} ⁠;
document.getElementById('nbLoc').textContent='Location: '+next.loc;
document.getElementById('nbChip').style.display='inline-block';
}
// calendar
const now=DateTime.now().setZone(PERTH);const start=now.startOf('month');const days=now.daysInMonth;
const cal=document.getElementById('calendar');cal.innerHTML='';
document.getElementById('monthName').textContent=now.toFormat('LLLL yyyy');
const offset=(start.weekday)%7;
for(let j=0;j<offset;j++){const d=document.createElement('div');d.className='day';cal.appendChild(d);}
for(let d=1;d<=days;d++){const cell=document.createElement('div');cell.className='day';
if(d===now.day)cell.classList.add('today');const dn=document.createElement('div');dn.className='dayNum';dn.textContent=d;
cell.appendChild(dn);
const dayStart=start.plus({days:d-1}).startOf('day');const dayEnd=dayStart.endOf('day');
evts.forEach(e=>{
const s=parseUTCtoAWST(e.start),ee=parseUTCtoAWST(e.end);
if(s>=dayStart&&s<=dayEnd){const ev=document.createElement('div');ev.className='event';
ev.textContent=⁠ ${s.toFormat('HH:mm')}–${ee.toFormat('HH:mm')} Busy ⁠;cell.appendChild(ev);}
});
cal.appendChild(cell);}
showSlide(0);setInterval(()=>{i=(i+1)%slides.length;showSlide(i);},DUR[i]);
})();
</script>
</body>
</html>
